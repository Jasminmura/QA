{
	"info": {
		"_postman_id": "e899364a-03b8-499b-8d53-18e15e869fc2",
		"name": "Collection 1",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "46130357",
		"_collection_link": "https://jasmen-4157632.postman.co/workspace/2d5c6ec2-bbc0-4bc4-8724-5894ac04787d/collection/46130357-e899364a-03b8-499b-8d53-18e15e869fc2?action=share&source=collection_link&creator=46130357"
	},
	"item": [
		{
			"name": "CreateBooking",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Parse request body\r",
							"const requestBody = pm.request.body.raw;\r",
							"let parsedBody;\r",
							"\r",
							"try {\r",
							"    parsedBody = JSON.parse(requestBody);\r",
							"} catch (e) {\r",
							"    console.error(\"Failed to parse request body:\", e);\r",
							"}\r",
							"\r",
							"// ✅ Test 1: Check request body has required fields\r",
							"pm.test('✅ Request body contains all required fields', () => {\r",
							"    pm.expect(parsedBody).to.be.an('object');\r",
							"    pm.expect(parsedBody).to.have.all.keys('firstname', 'lastname', 'totalprice', 'depositpaid', 'bookingdates', 'additionalneeds');\r",
							"    pm.expect(parsedBody.bookingdates).to.have.all.keys('checkin', 'checkout');\r",
							"});\r",
							"\r",
							"// ✅ Parse response (only once!)\r",
							"const response = pm.response.json();\r",
							"\r",
							"// ✅ Test 2: Booking created successfully\r",
							"pm.test('✅ Booking created successfully', () => {\r",
							"    pm.expect(response).to.have.property('bookingid');\r",
							"    pm.expect(response.booking).to.have.all.keys('firstname', 'lastname', 'totalprice', 'depositpaid', 'bookingdates', 'additionalneeds');\r",
							"    \r",
							"    // Save booking ID for later use\r",
							"    pm.environment.set(\"userBookingId\", response.bookingid);\r",
							"});\r",
							"\r",
							"// Logged-in user (mocked)\r",
							"const loggedInUser = {\r",
							"    firstname: \"Najla\",\r",
							"    lastname: \"sh\"\r",
							"};\r",
							"\r",
							"// ✅ Test 3: User who created the booking is the logged-in user\r",
							"pm.test('✅ Booking was made by the logged-in user', () => {\r",
							"    pm.expect(response.booking.firstname).to.equal(loggedInUser.firstname);\r",
							"    pm.expect(response.booking.lastname).to.equal(loggedInUser.lastname);\r",
							"});\r",
							"\r",
							"// ✅ Save environment variables for later use\r",
							"pm.environment.set(\"ID\", response.bookingid);\r",
							"pm.environment.set(\"firstname\", response.booking.firstname);\r",
							"pm.environment.set(\"lastname\", response.booking.lastname);\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"firstname\" : \"Najla\",\r\n    \"lastname\" : \"sh\",\r\n    \"totalprice\" : 200,\r\n    \"depositpaid\" : true,\r\n    \"bookingdates\" : {\r\n        \"checkin\" : \"2019-01-01\",\r\n        \"checkout\" : \"2020-01-01\"\r\n    },\r\n    \"additionalneeds\" : \"Breakfast\"\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://restful-booker.herokuapp.com/booking",
					"protocol": "https",
					"host": [
						"restful-booker",
						"herokuapp",
						"com"
					],
					"path": [
						"booking"
					]
				}
			},
			"response": [
				{
					"name": "JSON",
					"originalRequest": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "<booking>\r\n  <firstname>Jim</firstname>\r\n  <lastname>Brown</lastname>\r\n  <totalprice>111</totalprice>\r\n  <depositpaid>true</depositpaid>\r\n  <bookingdates>\r\n    <checkin>2018-01-01</checkin>\r\n    <checkout>2019-01-01</checkout>\r\n  </bookingdates>\r\n  <additionalneeds>Breakfast</additionalneeds>\r\n</booking>",
							"options": {
								"raw": {
									"language": "xml"
								}
							}
						},
						"url": {
							"raw": "https://restful-booker.herokuapp.com/booking",
							"protocol": "https",
							"host": [
								"restful-booker",
								"herokuapp",
								"com"
							],
							"path": [
								"booking"
							]
						}
					},
					"_postman_previewlanguage": null,
					"header": null,
					"cookie": [],
					"body": null
				},
				{
					"name": "URL",
					"originalRequest": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "<booking>\r\n  <firstname>Jim</firstname>\r\n  <lastname>Brown</lastname>\r\n  <totalprice>111</totalprice>\r\n  <depositpaid>true</depositpaid>\r\n  <bookingdates>\r\n    <checkin>2018-01-01</checkin>\r\n    <checkout>2019-01-01</checkout>\r\n  </bookingdates>\r\n  <additionalneeds>Breakfast</additionalneeds>\r\n</booking>",
							"options": {
								"raw": {
									"language": "xml"
								}
							}
						},
						"url": {
							"raw": "https://restful-booker.herokuapp.com/booking",
							"protocol": "https",
							"host": [
								"restful-booker",
								"herokuapp",
								"com"
							],
							"path": [
								"booking"
							]
						}
					},
					"_postman_previewlanguage": null,
					"header": null,
					"cookie": [],
					"body": null
				}
			]
		},
		{
			"name": "CreateTokin",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.environment.set(\"TOKEN\", pm.response.json().token);\r",
							"pm.test(\"User is logged in\", () => {\r",
							"    const response = pm.response.json();\r",
							"    pm.expect(response.token).to.exist;\r",
							"    pm.expect(response.token).to.be.a('string');\r",
							"    pm.expect(response.token).to.have.length.greaterThan(0);\r",
							"});"
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"packages": {},
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"username\" : \"admin\",\r\n    \"password\" : \"password123\"\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://restful-booker.herokuapp.com/auth",
					"protocol": "https",
					"host": [
						"restful-booker",
						"herokuapp",
						"com"
					],
					"path": [
						"auth"
					]
				}
			},
			"response": []
		},
		{
			"name": "UpdateBooking",
			"protocolProfileBehavior": {
				"disabledSystemHeaders": {}
			},
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Cookie",
						"value": "token={{TOKEN}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"firstname\" : \"Najla\",\r\n    \"lastname\" : \"dr\",\r\n    \"totalprice\" : 210,\r\n    \"depositpaid\" : true,\r\n    \"bookingdates\" : {\r\n        \"checkin\" : \"2019-01-01\",\r\n        \"checkout\" : \"2020-01-01\"\r\n    },\r\n    \"additionalneeds\" : \"Breakfast\"\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://restful-booker.herokuapp.com/booking/3696",
					"protocol": "https",
					"host": [
						"restful-booker",
						"herokuapp",
						"com"
					],
					"path": [
						"booking",
						"3696"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get Booking By ID",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"pm.test(\"Save first booking ID to environment\", function () {\r",
							"    const jsonData = pm.response.json();\r",
							"\r",
							"    // Make sure the response is an array and not empty\r",
							"    if (Array.isArray(jsonData) && jsonData.length > 0) {\r",
							"        const bookingId = jsonData[0].bookingid;\r",
							"        console.log(\"Setting booking ID:\", bookingId);  // ✅ For debugging\r",
							"        pm.environment.set(\"ID\", bookingId);\r",
							"    } else {\r",
							"        console.log(\"Response is empty or not an array\");\r",
							"    }\r",
							"});\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{URL}}/booking/{{ID}}",
					"host": [
						"{{URL}}"
					],
					"path": [
						"booking",
						"{{ID}}"
					],
					"query": [
						{
							"key": "ID",
							"value": null,
							"disabled": true
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Get All Bookings",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Response status is 200\", function () {\r",
							"    pm.response.to.have.status(200);\r",
							"});\r",
							"\r",
							"// Parse the response\r",
							"const response = pm.response.json();\r",
							"\r",
							"// Extract all booking IDs from the response\r",
							"const bookingIds = response.map(booking => booking.bookingid);\r",
							"\r",
							"// Get the user booking ID from environment\r",
							"const userBookingId = parseInt(pm.environment.get(\"ID\"));\r",
							"console.log(\"the booking id value\",userBookingId);\r",
							"// Check that the booking ID exists in the list\r",
							"pm.test(\"User's booking ID is found in the list\", function () {\r",
							"    pm.expect(bookingIds).to.include(userBookingId);\r",
							"});\r",
							""
						],
						"type": "text/javascript",
						"packages": {}
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{URL}}/booking",
					"host": [
						"{{URL}}"
					],
					"path": [
						"booking"
					]
				}
			},
			"response": []
		}
	]
}